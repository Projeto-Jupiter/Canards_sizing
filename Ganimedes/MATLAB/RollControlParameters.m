%Rocket data
radius = 105.8/2000;
J = 0.030;
Ar = pi*radius^2;
Lr = 2*radius;
damping_aletas_coef = [35.79228632167191
35.793707606749045
35.79797272860113
35.80508549052479
35.81505224281502
35.82788190003399
35.84358596532243
35.86217856189141
35.883676471872434
35.90809918274792
35.935468941629
35.965810817695505
35.99915277316431
36.03552574320716
36.074963725297856
36.11750387853352
36.16318663354396
36.21205581368025
36.264158768258
36.31954651872324
];
damping_canard_coef = [2.1634821712846173
2.163668568396632
2.1642280908471103
2.1651617337081452
2.166471161214145
2.168158715497549
2.1702274289486545
2.172681040332212
2.175524014835391
2.1787615682669643
2.182399695676835
2.186445204719502
2.190905754145782
2.195789897875477
2.201107135181279
2.206867967602896
2.213083963312441
2.219767829770202
2.2269334956472795
2.2345962031521873
];
forcing_canard_coef = [1.6496306282951438
1.649772753979879
1.6501993835050852
1.650911275601953
1.6519096992303517
1.6531964402397126
1.6547738107932606
1.6566446616567307
1.6588123974847182
1.6612809952722816
1.6640550261770053
1.667139680958268
1.670540799326739
1.6742649035492922
1.6783192367136635
1.6827118061248232
1.687451432382861
1.6925478047821814
1.6980115437765908
1.7038542713772793];

derivada_coef_f_canards = 1.6496306282951438;
derivada_coef_D_canards = 2.1634821712846173;
derivada_coef_f_aletas =  10.88468582071296;
derivada_coef_D_aletas = 35.79228632167191;

%Environment data
rho = 1.06; % air density
speed = 0.4*343; % Mach 0.4
DynamicPressure = (speed^2)*rho/2;

%Canard
i = 1;
CanardGain = forcing_canard_coef(i);
P = DynamicPressure * Ar * Lr * Lr / 2 / speed;
C = derivada_coef_D_aletas + derivada_coef_D_canards;
Kdelta = DynamicPressure*Ar*Lr*(derivada_coef_f_aletas-derivada_coef_f_canards);
Gp = tf([0 Kdelta],[J P*C]);

%Servo
tau_s = 0.07/(pi/3);
Gs = tf(1, [tau_s 1]);

%Controller
s = tf([1 0], 1);
Kp = 0.015;
Ki = 0.0315;
Kd = 0.0;
Gc1 = Kp + Ki/s + Kd*s;

Kp = 0.17;
Ki = 0.0315;
Kd = 0.0;
I = Ki/Kp;
D= Kd/Kp;
Gc2 = Kp*(1 + I/s + D*s);

%Transfer Function
Gf = feedback(Gc1*Gs*Gp, 1);